Symbol generation code was copied and adapted from kile.